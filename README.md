# GeoscnVert
Стажировочный проект

# Управление RGB-подсветкой вертипортов

## Описание
Программа предназначена для управления RGB-подсветкой вертипортов через TCP-контроллер. Она предоставляет визуальный интерфейс для ввода IP-адреса устройства, автоматического поиска устройства в локальной сети, а также настройки параметров вертипортов.

## Функционал

### Запуск программы
При запуске программы отображается визуальный интерфейс, разделённый на зоны для более удобного восприятия. Все элементы интерфейса подписаны. Интерфейс включает:
- Окно ввода IP-адреса устройства.
- Кнопки для автоматического поиска устройства и ручного подключения.
- Индикатор состояния подключения.
- Панель настройки параметров вертипортов.

### Автоматический поиск устройства
При нажатии на кнопку «Автоматический поиск» программа начинает сканирование локальной сети для поиска устройства. Если устройство найдено, программа автоматически подключается к нему, вставляет IP-адрес в окно ввода и отображает всплывающее окно с сообщением об успешном подключении и IP-адресом устройства. Индикатор состояния подключения меняет цвет с серого на зеленый.

Если устройство не найдено в локальной сети, программа отобразит всплывающее окно с сообщением об отсутствии устройств, а индикатор состояния подключения изменит цвет на красный.

### Ручной ввод IP-адреса
Пользователь может ввести IP-адрес устройства вручную. При нажатии на кнопку «Подключиться» программа проверяет правильность введенного IP-адреса. Если адрес введен правильно, программа пытается подключиться к устройству. В случае успешного подключения индикатор состояния подключения изменит цвет на зеленый.

Если введенный IP-адрес некорректен или пуст, программа отобразит всплывающее окно с предупреждением. Если адрес корректен, но не соответствует устройству, подключение не произойдет, и индикатор состояния подключения останется красным.

### Настройка вертипортов
После успешного подключения пользователь может настроить параметры вертипортов. Программа поддерживает управление шестью вертипортами. Каждый вертипорт содержит:
- Маркер выбранного цвета.
- Кнопку выбора цвета, при нажатии на которую открывается палитра RGB.
- Выпадающий список для выбора режима работы.
- Кнопку "Старт" для применения настроек.

#### Особенности
- При первичном запуске заданный цвет лент установлен в белый.
- Если пользователь пропускает выбор цвета и просто выбирает режим, цвет лент будет белым.
- При выборе цвета он сохраняется как последний использованный.
- Если пользователь меняет режим, но не выбирает цвет, к порту будет применяться последний выбранный цвет (за исключением режима «Радуга»).

### Автоматическое переподключение
Программа имеет функцию автоматического переподключения к исходному IP-адресу в случае разрыва или потери соединения. Если разрыв произошел при отправке данных, программа отправит пакет с набором данных, заданным пользователем для данного порта.

### Первичная настройка
Первичная настройка включает определение IP-адреса устройства. Порядок задания параметров для порта или порядок задания самих портов, а также применения к ним параметров не имеет значения и может быть произвольным.

### Работа без подключения
Пользователь может менять режим работы портов, их цвет или нажимать кнопку «Старт» без подключения к устройству. Программа не будет реагировать на эти действия, но предупреждений, сбоев, зависаний или аварийного завершения работы не будет.

## Классы программы и их взаимодействие

### Сканер устройств
Класс `DeviceScanner` отвечает за сканирование локальной сети и поиск устройств. Он наследуется от `QObject` и использует сигналы и слоты для взаимодействия с другими компонентами программы.

#### Методы
- `__init__(self, port=502, parent=None)`: Инициализация объекта с заданным портом.
- `send_request(self, ip)`: Отправка запроса на устройство по заданному IP-адресу.
- `scan_network(self)`: Сканирование локальной сети для поиска устройств.
- `get_local_ip(self)`: Получение локального IP-адреса.
- `start_scan(self)`: Запуск сканирования сети в отдельном потоке.

#### Сигналы
- `deviceFound`: Сигнал, отправляемый при обнаружении устройства.
- `scanCompleted`: Сигнал, отправляемый при завершении сканирования.

### STMLedController
Класс `STMLedController` отвечает за управление RGB-лентами через TCP-контроллер. Он содержит методы для отправки команд на устройство и обработки ответов.

#### Методы
- `__init__(self, ip=None, port=None)`: Инициализация объекта с заданным IP-адресом и портом.
- `_create_client(self, ip, port)`: Создание TCP-клиента для подключения к контроллеру.
- `_send_message(self, msg)`: Отправка сообщения на контроллер с автоматическим переподключением.
- `_read(self)`: Чтение данных с контроллера.
- `_who_i_am(self)`: Определение устройства по уникальному идентификатору.
- `change_vertiport(self, id, status, r, g, b)`: Изменение состояния и цвета для указанного порта.
- `reconnect(self, msg=None)`: Попытка восстановления соединения и повторная отправка данных, если необходимо.
- `disconnect(self)`: Отключение от контроллера.
- `test_connection(self)`: Тестирование соединения.

### Светодиодный контроллер
Класс `LedController` отвечает за управление подключением к устройству и настройку параметров вертипортов. Он наследуется от `QObject` и использует сигналы и слоты для взаимодействия с другими компонентами программы.

#### Методы
- `__init__(self, parent=None)`: Инициализация объекта.
- `connect(self, ip, port)`: Установка соединения с контроллером.
- `change_vertiport(self, id, status, r, g, b)`: Изменение параметров порта.
- `is_valid_ip(self, ip)`: Проверка корректности IP-адреса.
- `validate_and_format_ip(self, ip)`: Проверка и приведение IP-адреса к стандартному виду.
- `start_scan(self)`: Запуск сканирования сети.
- `on_device_found(self, ip)`: Обработка события нахождения устройства.
- `on_scan_completed(self, found)`: Обработка события завершения сканирования.

#### Сигналы
- `connectionStatusChanged`: Сигнал, отправляемый при изменении состояния подключения.

### Главное окно
Класс `MainWindow` отвечает за создание визуального интерфейса и взаимодействие с пользователем. Он наследуется от `QWidget` и использует сигналы и слоты для взаимодействия с другими компонентами программы.

#### Методы
- `__init__(self)`: Инициализация объекта и создание визуального интерфейса.
- `initUI(self)`: Создание и настройка визуального интерфейса.
- `on_device_found(self, ip)`: Обработка события нахождения устройства.
- `on_scan_completed(self, found)`: Обработка события завершения сканирования.

